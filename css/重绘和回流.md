# 重绘和回流

回流: 当元素的尺寸、位置、结构发生变化时,浏览器需要重新计算布局

重绘: 当元素外观改变但不影响布局时，浏览器只需重新绘制样式

页面的出渲染流程

1.构建 dom 树

DOM树是浏览器把HTML解析成树状结构,每个标签,文本,和属性都是节点,js可以操作页面内容和结构

DOM 树中节点之间的关系有父子、兄弟、祖先与后代

2.样式计算

3.布局定位

浏览器根据 DOM 树和 CSSOM 树计算每个节点的几何信息（位置和尺寸）
这一步骤通常称为“回流”，涉及到确定元素在视口中的确切位置

4.图层分层

对于复杂的页面，浏览器可能会将元素分成多个图层进行处理。某些 CSS 属性（如 position: fixed、opacity、transform 等）会导致创建新的合成图层。这有助于提高性能，尤其是在需要频繁重绘的情况下

5.图层绘制

浏览器根据 Render 树和合成图层，绘制每个图层的内容。此过程涉及将文本、颜色、边框、阴影等视觉效果绘制到屏幕上

6.合成显示

在最后一步，所有图层会被合成成最终的屏幕显示内容。浏览器利用 GPU 加速来完成这个过程，使得合成速度更快，尤其在复杂的动画和交互中表现更佳

## 额外优化

回流与重绘的优化：浏览器会将所有回流和重绘操作放在一个队列中，当达到一定数量或经过一定时间间隔时进行批处理，提升性能

### 硬件加速

浏览器中的层分为两种：「渲染层」和「合成层」

1. 渲染层

渲染层的概念跟层叠上下文密切相关。简单来说，拥有 z-index 属性的定位元素会生成一个层叠上下文，一个生成层叠上下文的元素就生成了一个渲染层

2. 合成层

只有一些特殊的渲染层才会被提升为合成层，通常来说有这些情况

1. transform:3D 变换：translate3d，translateZ；
2. will-change:opacity | transform | filter
3. 对 opacity | transform | fliter 应用了过渡和动画（transition/animation）
4. video、canvas、iframe

利用硬件加速，可以把需要重排/重绘的元素单独拎出来

避免重排/重绘，直接进行合成，合成层的 transform 和 opacity 的修改都是直接进入合成阶段的；

“在使用过渡、动画或设置 will-change 时，可以使用 transform: translate 来代替 left 和 top 修改元素的位置；使用 transform: scale 来代替宽度和高度的修改
