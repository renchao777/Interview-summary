# 前端安全

## xss 跨站脚本攻击

**概念：攻击者在网页中注入恶意脚本，当用户浏览时执行，可能窃取 cookie、表单数据、篡改页面或发起恶意请求**

三种类型：

1. 反射型 XSS：用户点击包含恶意脚本的链接，脚本立即在浏览器执行

2. 存储型 XSS：恶意脚本存储在服务器（如数据库），访问页面时执行

3. DOM-based XSS：恶意脚本通过修改页面 DOM 执行，通常发生在 v-html 或动态 innerHTML 渲染用户内容时

实际应用场景: 

1. 文章富文本

用户或管理员发布的文章可能包含格式化文本和图片,渲染时使用 v-html，先用编辑器或 DOMPurify 做安全过滤，禁止 <script>、<iframe> 等危险标签

意识到问题：直接渲染用户 HTML 不安全，可能被注入 <script>、<iframe> 或事件属性。

编辑器端过滤（可选）：在 WangEditor 中限制允许的标签和属性，只保留必要的格式和图片，过滤危险标签
```js
import E from 'wangeditor'

const editor = new E('#editor')

// 配置菜单，只允许必要功能
editor.config.menus = [
  'bold', 'italic', 'underline', 'head', 'link', 'list', 'quote', 'image'
]

// 粘贴过滤，移除危险标签
editor.config.pasteTextHandle = function (pasteStr) {
  return pasteStr.replace(/<(script|iframe|style)[\s\S]*?>[\s\S]*?<\/\1>/gi, '')
}

editor.create()

```

渲染端二次清理（必须）：用 DOMPurify 做白名单过滤，即使用户绕过编辑器也能防止注入攻击。

```js
import DOMPurify from 'dompurify'

export default {
  props: {
    content: String  // 后端返回的文章 HTML
  },
  computed: {
    safeContent() {
      return DOMPurify.sanitize(this.content, {
        ALLOWED_TAGS: [
          'b','i','em','strong','a','p','ul','ol','li','br','img','blockquote','h1','h2','h3'
        ],
        ALLOWED_ATTR: ['href','src','alt','title','target']
      })
    }
  }
}
```

安全渲染：处理后的 HTML 通过 v-html 渲染，既安全又保留格式和图片

2. 无感知 Token 刷新机制。用户登录后，长 Token（Refresh Token）存储在 HttpOnly Cookie，前端无法直接访问，这样即便出现 XSS 攻击，Token 也不会被窃取

## CSRF 跨站请求伪造

**概念：攻击者诱导用户在已登录状态下，向可信任网站发起恶意请求，利用浏览器自动携带 cookie/session，使网站误以为是用户的真实操作**

1. 用户在网站 A 登录，浏览器保存了该网站的 Cookie

2. 攻击者诱导用户点击恶意链接或访问攻击页面

3. 在用户未登出的情况下，攻击者的请求会自动携带 Cookie 发送给网站 A

4. 网站 A 无法分辨请求是用户真实发出的还是攻击伪造的

### 常见攻击方式

GET 请求伪造：通过 <img>、<a>、<script> 等方式自动请求

POST 请求伪造：通过隐藏表单 + JavaScript 自动提交

恶意第三方网站：在诱导点击按钮时触发请求

实际运用场景:

1. 用户资料修改, 密码修改, 发帖评论

Vue + Axios 调用接口修改用户资料
```js
axios.post('/api/user/update', {
  nickname: '哥',
  email: 'me@example.com'
})
```
如果后端只依赖 Cookie 做认证，攻击者在恶意网站放一个表单：

```js
<form action="https://yourapp.com/api/user/update" method="POST">
  <input type="hidden" name="nickname" value="黑客" />
  <input type="hidden" name="email" value="hacker@evil.com" />
  <input type="submit" />
</form>
```

登录时从后端拿到 csrfToken，存到 localStorage 或状态管理里
使用 Axios 请求拦截器，每次请求自动带上 X-CSRF-Token 头