# 项目中使用的组件 

## 项目中的 pupop 组件

1. 组件架构：

这是一个可复用的弹出框组件,调用风格和常规 JS 函数类似

通过 Vue.extend 创建组件构造器并在需要时动态实例化，随后使用 $mount() 手动挂载,在需要时插入到 body，方便在任何地方调用

---- 挂载就是把组件实例渲染到页面的过程，$mount() 触发生成虚拟 DOM，然后通过 patch 转成真实 DOM 并插入页面，挂载完成后触发 mounted 钩子 --- 

2. 动态加载内容：

动态加载弹出框的内容可以根据不同需求进行切换

3. 状态管理简化：

内部只维护必要的状态, 比如 visible 和 loading, 其余逻辑交给外部控制,保证组件简洁易用

4. CSS 样式：

通过 scoped CSS 避免全局样式冲突, 提升可维护性

```html
<template>
  <div v-if="myShow" class="popup-mask">
    <div class="popup-box">
      <div class="popup-header">{{ title }}</div>

      <!-- 异步组件 -->
      <component v-if="contentComponent" :is="contentComponent" v-bind="contentProps"></component>

      <!-- 按钮 -->
      <div v-if="btnShow" class="popup-footer">
        <button @click="handleConfirm">{{ confirmText }}</button>
        <button @click="handleCancel">{{ cancelText }}</button>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      myShow: false,
      btnShow: true,
      title: "提示",
      contentComponent: null,
      contentProps: {},
      confirmCallback: null,
      cancelCallback: null,
      confirmText: "确定",
      cancelText: "取消",
    };
  },
  methods: {
    async open({ title, componentPath, props, btnShow, confirmText, cancelText, onConfirm, onCancel }) {
      this.title = title || "提示";
      this.btnShow = btnShow !== undefined ? btnShow : true;
      this.confirmText = confirmText || "确定";
      this.cancelText = cancelText || "取消";
      this.confirmCallback = onConfirm || (() => {});
      this.cancelCallback = onCancel || (() => {});
      this.contentProps = props || {};

      // 异步加载组件
      if (componentPath) {
        this.contentComponent = () => import(`${componentPath}`);
      } else {
        this.contentComponent = null;
      }

      this.myShow = true;
    },
    handleConfirm() {
      this.confirmCallback();
      this.close();
    },
    handleCancel() {
      this.cancelCallback();
      this.close();
    },
    close() {
      this.myShow = false;
      this.$destroy();
      this.$el.parentNode && this.$el.parentNode.removeChild(this.$el);
    }
  }
};
</script>

<style scoped lang="scss">
.popup-mask {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  display: flex;
  justify-content: center;
  align-items: center;
}
.popup-box {
  background: #fff;
  border-radius: 8px;
  padding: 16px;
  width: 400px;
}
.popup-header {
  font-weight: bold;
  margin-bottom: 12px;
}
.popup-footer {
  margin-top: 12px;
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}
button {
  padding: 6px 12px;
  border-radius: 4px;
  border: none;
  cursor: pointer;
}
button:hover {
  background: #f5f5f5;
}
</style>
```

```js
import Vue from "vue";
import Popup from "./Popup.vue";

let popupInstance = null;
const COMPONENT_BASE_PATH = "@/components/popup/"; // 默认组件目录

export default {
  install(Vue) {
    Vue.prototype.$popup = function(title = "提示", componentFile = "", options = {}) {
      if (!popupInstance) {
        const Constructor = Vue.extend(Popup);
        popupInstance = new Constructor();
        popupInstance.$mount();
        // $mount() 只能生成 $el，不会插入页面
        document.body.appendChild(popupInstance.$el);
      }

      const componentPath = componentFile ? `${COMPONENT_BASE_PATH}${componentFile}` : "";

      popupInstance.open({
        title,
        componentPath,
        ...options
      });

      return { close: () => popupInstance.close() };
    };
  }
};

```