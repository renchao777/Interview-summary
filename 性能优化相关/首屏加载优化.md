# Vue 项目首屏加载优化方案

## 代码层优化

1. 路由懒加载（按需加载页面组件，减少初始 JavaScript 文件体积）- 优化原理：只有用户访问特定路由时才会加载相应的组件，减少初始加载时间。

```js
const Home = () => import("@/views/Home.vue");
const About = () => import("@/views/About.vue");

const routes = [
  { path: "/", component: Home },
  { path: "/about", component: About },
];
```

2. 组件异步加载(将非核心组件延迟加载，减少主 bundle 的大小)

```js
const AsyncComponent = () => import("@/components/AsyncComponent.vue");
```

## Webpack 配置优化

1. 使用 splitChunks 优化代码分割(分离出公共代码和第三方库和公共模块，避免重复打包，利用浏览器缓存)
   使用 splitChunks 插件可以有效分割出第三方库（如 vendors）和应用程序的公共部分，减少重复加载，充分利用缓存

```js
module.exports = {
  optimization: {
    splitChunks: {
      chunks: "all", // 对所有类型的代码块进行分割，包括异步和同步的代码
      minSize: 20000, // 生成块的最小大小（单位：字节），可根据需求调整
      maxSize: 50000, // 生成块的最大大小，控制分割后的文件大小
      minChunks: 1, // 模块被最少引用次数，只有被引用次数达到此值时才会被分割
      maxAsyncRequests: 7, // 按需加载时的最大并行请求数量，通常异步请求较多
      maxInitialRequests: 5, // 入口文件的最大并行请求数量，避免过多并行请求
      automaticNameDelimiter: "~", // 命名分隔符
      cacheGroups: {
        // 提取第三方库
        vendors: {
          test: /[\\/]node_modules[\\/]/, // 匹配 node_modules 文件夹下的模块
          name: "vendors", // 输出文件名
          chunks: "all", // 对同步和异步代码块均进行处理
          priority: -10, // 优先级
          enforce: true, // 强制分割，即使文件大小低于 minSize
        },
        // 提取公共模块
        common: {
          name: "common", // 公共模块的输出文件名
          minChunks: 2, // 最少被两个模块引用才会被提取
          chunks: "all", // 对所有代码块进行处理
          priority: -20, // 优先级低于 vendors
          reuseExistingChunk: true, // 如果模块已经被打包过则复用
        },
      },
    },
  },
};
```

2. CSS 提取和压缩
   使用 MiniCssExtractPlugin 将 CSS 从 JavaScript 中提取到独立的文件中，避免 CSS 被打包到 JS 里影响加载。同时使用 CssMinimizerPlugin 压缩 CSS 文件

```js
const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");

module.exports = {
  plugins: [
    new MiniCssExtractPlugin({
      filename: "[name].[contenthash].css",
    }),
  ],
  optimization: {
    minimizer: [new CssMinimizerPlugin()],
  },
};
```

3. 配置资源的预加载，提升了应用的性能
   预加载: 使用 <link rel="preload"> 标签在 HTML 文档中提前加载关键资源（如 JavaScript 和 CSS），使得浏览器可以在初始渲染期间并行下载这些资源，从而减少用户看到的空白时间

```js
chainWebpack: (config) => {
  // 配置 preload 插件
  config.plugin("preload").tap(() => [
    {
      rel: "preload",
      fileBlacklist: [/\.map$/, /hot-update\.js$/, /runtime\..*\.js$/],
      include: "initial",
    },
  ]);
};
```

## 服务端优化

1. 启用 Gzip，减少文件传输体积
   通过压缩减少传输文件的大小，加快页面加载

```js
gzip on;
gzip_types text/plain text/css application/json application/javascript;
gzip_min_length 1024;

```

2. 使用 HTTP/2 多路复用
   启用 HTTP/2 提高并发加载效率，减少请求延迟

```js
   server {
    listen 443 ssl http2;
    server_name your-domain.com;
    ssl_certificate /path/to/ssl_certificate;
    ssl_certificate_key /path/to/ssl_certificate_key;
   }

```

3. Nginx 配置 http 缓存
   利用 Nginx 的 proxy_cache 和 expires 指令来缓存动态内容和静态资源，减少服务器负担
